<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1.0" />
	<title>Courts of Chaos</title>
	<style>
		.c{width:100%;height:100%;image-rendering:pixelated;image-rendering:-moz-crisp-edges}
		.u{position:fixed;top:2px;cursor:pointer;filter:drop-shadow(0 2px 0 rgba(0,0,0,.25))}
		.s{background-color:#126;}
		.a{position:absolute;top:0;}
		.r{transform:scaleX(-1)}
		.d{filter:drop-shadow(0 1px 0 rgba(0,2,8,.8))}
		.b{filter:drop-shadow(0 -1px 0 rgba(0,2,8,.5))}
		.e{background-color:rgba(190,256,190,.3);border:5px solid rgba(255,255,255,.2);border-bottom:0;filter:drop-shadow(0 -3px 0 rgba(255,255,255,.8))}
		.o{cursor:pointer}
	</style>
</head>
<body style=margin:0;overflow:hidden;>
	<div id=game style=background-repeat:no-repeat;>
		<div id=h class="c a" style=z-index:-1;><!-- header bgr -->
			<div id=sky class="c a"></div><!-- sky bgr -->
		</div>
		<canvas id=f class=c></canvas><!-- surface layer -->
		<div id=zz class="c a b"><!-- units layer -->
			<div id=z class="c a d"></div>
		</div>
		<div id=v class=u style=image-rendering:pixelated;image-rendering:-moz-crisp-edges;><!-- UI layer -->
			<div id=hp class=u style=top:6px;left:12px;>
				<div class="a d e" style=top:26px;left:12px;></div>
			</div>
			<div id=ex title="Exit game" class=u style=left:914px;></div>
			<div id=fs title="Full-screen" class=u style=left:834px;></div>
			<div id=ui title="toggle UI buttons" class=u style=left:770px;opacity:1;></div>
			<div id=cl class="c a d" style=background-color:rgba(99,199,99,.6);>
				<div id=id_38 class="a d e" style=left:837px;top:-138px;border-left:0;></div>
				<div id=id_40 class="a d e" style=left:837px;top:-33px;border-left:0;></div>
				<div id=id_37 class="a d e" style=left:767px;top:-84px;border-right:0;></div>
				<div id=id_39 class="a d e" style=left:898px;top:-84px;border-right:0;></div>
				<div id=id_32 class="a d e" style=left:832px;top:-73px;border-right:0;></div>
				<div id=id_49 class="a d e" style=left:2px;top:-66px;padding-bottom:8px;display:none;></div>
				<div id=id_50 class="a d e" style=left:2px;top:-134px;padding-bottom:8px;display:none;></div>
				<div id=id_48 class="a d e" style=left:98px;top:-66px;padding-bottom:8px;display:none;></div>
			</div>
		</div>
	</div>
	<script>

		// SoundFX, shrinked
		
		// SoundFX, optimized
		
		// SoundFX, sound effects
		FX = (c=>{
			var soundContext = new (window.AudioContext || window.webkitAudioContext)();
			var oscTypes = ['square', 'sawtooth', 'triangle', 'sine'];
			var volume = 1;
			
			// start frequency HZ, frequency change, delay between changes, number of changes, volume, type (optional)
			function playSound(_freq, _incr, _delay, _times, _vol, _type){
				
				var oscillator = soundContext.createOscillator(); // instantiate oscillator
				oscillator.frequency.value = _freq;
				oscillator.type = oscTypes[_type || 0];
				
				var modulationGain = soundContext.createGain(); // instantiate modulation for sound volume control
				modulationGain.gain.value = 0;

				oscillator.connect(modulationGain);
				modulationGain.connect(soundContext.destination);
				oscillator.start();
				
				var i = 0;
				requestAnimationFrame(playTune);
				
				function playTune(){
					oscillator.frequency.value = _freq + _incr * i;
					modulationGain.gain.value = (1-(i/_times)) * _vol * volume;
					i ++;
					if(i < _times) {
						requestAnimationFrame(playTune);
					} else oscillator.stop();
				}
				
			}
			return{
				t:function(){//stuck
					playSound(200, -10, 15, 20, 0.1, 3);
				},
				h:function(c,d){//h
					playSound(160, 10, 15, 5+5*c, 0.1);
					playSound(250, -20, 30, 5+5*c, 0.1, 1);
					playSound(1500, -150, 30, 5+5*c, 0.02, d||0);
				},
				a:function(c){//h
					playSound(30, 10, 15, 15, 0.1, c||0);
					playSound(c*180||250, 30, 30, 9, 0.1, c||2);
				},
				c:function(){
					playSound(510, 0, 15, 20, 0.025);
					setTimeout(function(){playSound(2600, 1, 10, 30, 0.05);}, 80);
				}
			}
		})();


		// TypeFX, shrinked

		// TypeFX, optimized
		
		// TypeFX - canvas pixel font
		X = (function() {
			var symbols=[
				// 32 empty characters will be added here with Array.unshift
				
				[],									// ! (33) - space 1p
				[],												// " - space 25p (34)
				
				[[,,2], [,1,3], [1,2,3], [2,3,2], [3.25,4,1.75], [3.25,3.25,1.75], [4.5,5,1.5], [4.5,4.5,1.5]],	// # - blade 1
				[[,,1], [1,0.5], [0.5,1,2.5], [1,2,3], [2,3,3], [3,4,3], [4,5,2]],	// $ - blade 2
				[[], [0.5,0.5,1.5], [0.5,1,1.5], [1.5,1.5,1.75], [1.5,2.25,1.75], [2.5,2.5,1.75], [2.5,3.25,1.75], [3.25,4,2.5], [4,3.25,,2.5], [5,5]],		// % - blade 3
				
				[[6.5,5], [7,4], [4,7], [5,6.5], [5.5,5.5], [6,6]],					// & - guard 1
				[[6.5,5], [7.5,4], [4,7.5], [5,6.5], [6,6]],						// ' - guard 2 (39)
				
				[[7,6.5], [6.5,7], [7.5,7.5,1.5], [7.5,8,1.5]],						// ( - handle 1 (40)
				[[6.5,6.5], [7,7], [7.5,7.5,1.5], [7.5,8,1.5]],						// ) - handle 2 {41}
				
				[[,1], [,3], [1,2,3], [2,,,5], [4,1], [4,3]],				// * (42)
				[[,3,5], [2,1,,5]],											// + (43)
				[[1,6,,2], [,8]],											// , (44)
				[[,4,4]],													// - (45)
				[[,6]],														// . (46)
				[],															// / space 10p (47)
				

				[[1,1,3], [,2,,4], [1,6,3], [4,2,,4]],							// 0 (48)
				[[,2], [1,1,,5], [,6,3]],										// 1
				[[,2], [1,1,3], [4,2,,2], [1,4,3], [,5], [,6,5]],				// 2
				[[,1,5], [3,2], [4,5], [,6,4], [2,3], [1,4,3]],					// 3
				[[,4], [1,3], [2,2], [,5,5], [3,1,,6]],							// 4
				[[,1,5], [,2], [,3,4], [4,4,,2], [,5], [1,6,3]],				// 5
				[[1,1,3], [4,2], [,2,,4], [1,6,3], [1,4,3], [4,5]],				// 6
				[[,1,4], [3,2,,2], [2,4], [1,5,,2]],							// 7
				[[1,1,3], [,2], [4,2], [,4,,2], [4,4,,2], [1,3,3], [1,6,3]],	// 8
				[[1,1,3], [,2], [1,3,3], [4,2,,4], [1,6,3], [,5]],				// 9 (57)
				
				[[,2.5], [,5]],														// :

				[[,.5,3], [.5,,2], [4,,2], [3.5,.5,3], [,1,6.5], [.5,1.5,5.5], [1,2,4.5], [1.5,2.5,3.5], [2,3,2.5], [3,4,.5], [2.5,3.5,1.5]],	// ; - heart - (59)

				[[,3], [1,2], [1,4], [2,1], [2,5]],									// < (60)
				[[,3,4], [,5,4]],													// = (61)
				[[2,3], [1,2], [1,4], [,1], [,5]],									// > (62)
				[[,1], [1,,3], [4,1,,2], [3,3], [2,4], [2,6]],						// ?
				[[2,,2], [1,1],[,2,,4], [1,6,3], [4,3,,3], [3,2], [2,3,,2]],		// @
				
				[[,3,,4], [4,3,,4], [1,2,3], [,5,4]],									// A (65)
				[[,2,4], [,2,,5], [,4,4], [,6,4], [4,3], [4,5]],						// B
				[[1,2,3], [,3,,3], [1,6,3], [4,5], [4,3]],								// C
				[[,2,,5], [,2,4], [,6,4], [4,3,,3]],									// D
				[[,2,4], [,4,3], [,6,4], [,2,,5]],										// E
				[[,2,4], [,5,3], [,2,,5]],												// F (70)
				[[1,2,3],[,3,,3], [1,6,3], [4,4,,3], [3,4]],							// G
				[[,2,,5], [4,2,,5], [1,5,3]],											// H
				[[,2,3], [,6,3], [1,3,,3]],												// I
				[[3,2,,4], [1,6,2], [,5]],												// J
				[[,2,,5], [1,5], [2,4], [2,4], [3,3], [4,2], [3,5], [4,6]],				// K (75)
				[[,2,,5], [1,6,3]],														// L
				[[,2,,5], [1,4], [3,4], [2,5], [4,2,,5]],								// M
				[[,2,,5], [1,3], [2,4], [3,5], [4,2,,5]],								// N
				[[1,2,3], [,3,,3], [1,6,3], [4,3,,3]],									// O
				[[,2,,5], [,2,4], [,5,4], [4,3,,2]],									// P
				[[1,2,3], [,3,,3], [1,6,3], [4,3,,3], [4,7]],							// Q (81)
				[[,2,,5], [,2,4], [,5,4], [4,3,,2], [4,6]],								// R
				[[1,2,4], [,3], [1,4,3], [4,5], [,6,4]],								// S
				[[,2,5], [2,2,,5]],														// T
				[[,2,,4], [1,6,3], [4,2,,4]],											// U (85)
				[[,2,,2], [4,2,,2], [1,4,,2], [3,4,,2], [2,6]],							// V
				[[,2,,5], [1,5], [2,4], [3,5], [4,2,,5]],								// W
				[[,2], [1,3], [2,4], [3,5], [4,6], [4,2], [3,3], [1,5], [,6]],			// X
				[[,2,,2], [4,2,,2], [1,4], [3,4], [2,5,,2]],							// Y
				[[,2,5], [,6,5], [,5], [1,4,3], [4,3]],									// Z (90)
				
				[[,3,,3], [,2,9], [,6,9], [9,2,,5]],									// [
				[],																		// \
				[[2,2,3], [2,3], [,4,3], [,5], [,6,7], [4,3], [4,4,3], [6,5]],			// ]
				
				[[3],[2,1,2],[1,2,3],[,3,7],[3,4,3],[3,5,2],[2,6,2],[2,7]],	 			// ^ // thunder
				[[.5,1], [3.5,1], [.5,3], [3.5,3], [1.5,2,2], [2,.5,,1], [2,3.5,,1], [1,.5,,.5], [3,.5,,.5], [1,4,,.5], [3,4,,.5]],	 // _
				[[,1,,2]]																// `
				/*
				[],						// a (97)
				[],						// b
				[],						// c
				[],						// d (100)
				[],						// e
				[],						// f
				[],						// g (103)
				[],						// h
				[],						// i
				[],						// j
				[],						// k
				[],						// l
				[],						// m
				[],							// n (110)
				[[1,2,2], [,3,,3], [1,6,2], [3,3,,3]],					// o
				[],						// p
				[],						// q
				[],						// r
				[],						// s
				[],						// t (116)
				[],						// u
				[],						// v
				[],						// w
				[],						// x
				[],						// y
				[],						// z (122)
				
				[],						// {
				[],						// |
				[]						// }*/
			], s = [], i, j, k, h, w;
			
			for(i = 0; i < 33; i++) symbols.unshift([]);
			for(i = 0; i < 33; i++) symbols.push([]);
			for(i = 0; i < symbols.length; i++) {
				s.push(i==33?0:i<34||i==124?1:i==34?28:i<42||i>90&&i<95||i==59?10:i==44||i==96||i==46?2:[49,60,62,73].indexOf(i)>-1?3:[55,69,70,74,76].indexOf(i)>-1?4:5);
			}
			symbols[111]=[[1,2,2], [,3,,3], [1,6,2], [3,3,,3]];
			symbols[124]=[[,,,7]];

			function drawDiggit(_element, _diggit, _size, _color, _width, _height){
				if(!parseInt(_diggit)) _diggit = _diggit.charCodeAt(0);
				if(!_color) _color = "white";
				if(!_size) _size = 1;
				var canvas = _element.nodeName.toLowerCase();
				if(canvas == "canvas"){
					canvas = _element;
				} else {
					canvas = document.createElement("canvas");
				}
				canvas.width = _size * (_width || s[_diggit]);
				canvas.height = _size * (_height || 10);
				drawGlyph(canvas, _diggit, _size, _color);
				if(canvas!=_element) _element.appendChild(canvas);
				return canvas;
			}
			
			function drawGlyph(canvas, _diggit, _size, _color){
				var context = canvas.getContext("2d");
				context.fillStyle = _color;
				if(symbols[_diggit]){
					for(i = 0; i < symbols[_diggit].length; i++){
						if(symbols[_diggit][i].length == 4) {
							h = symbols[_diggit][i][3]; w = 1;
						} else if(symbols[_diggit][i].length == 3) {
							w = symbols[_diggit][i][2]; h = 1;
						} else {w = 1; h = 1;}
						context.beginPath();
						context.rect(symbols[_diggit][i][0]*_size||0, ((symbols[_diggit][i][1]||0)+1)*_size, w*_size, h*_size);
						context.fill();
					}
				}
			}
			
			function drawText(_element, _text, _size, _leading, _color){
				var _letter;
				var lines = _text.toUpperCase().split("\r");
				var widths = [];
				for(k = 0; k < lines.length; k++){
					widths.push(0);
					for(j = 0; j < lines[k].length; j++){
						_letter = drawDiggit(_element, lines[k].charCodeAt(j), _size, _color);
						_letter.style.position = "absolute";
						_letter.style.left = widths[k]+"px";
						_letter.style.top = k ? (k*_size*10 + (k*_leading||0))+"px" : 0;
						widths[k] += _letter.width + _size;
					}
				}
				_element.style.width = Math.max.apply(this, widths)+"px";
				_element.style.height = (lines.length*_size*10 + (lines.length*_leading||0))+"px";
			}
			
			return{
				d:drawDiggit,
				t:drawText
			}
		})();

		// TweenFX, shrinked
		
		// TweenFX - tweener of styles and transforms
		var Z = (function() {
			var paused,
			regex = /[+-]?\d+(\.\d+)?/g,
			props = ['opacity','left','top','right','bottom','width','height'],
			mods = ['rotate','scaleX','scaleY','translateX','translateY'],
			tweenedElements = [],
			tweenedIntervals = [];
			
			function tweenTo(_element, _duration, _object, _callback, _arguments){// duration represents the number of animation frames needed to reach target
				var i,
				count = 0,
				delay = 5,
				step = 5,
				obj,
				mod,
				tweenObj = [],
				trans,
				object = {};

				for(obj in _object){
					if(obj == 'x') object.translateX = _object[obj];
					else if(obj == 'y') object.translateY = _object[obj];
					else if(obj == 'alpha' || obj == 'a') object.opacity = _object[obj];
					else if(obj == 'scale' || obj == 's') {
						object.scaleX = _object[obj];
						object.scaleY = _object[obj];
					} else object[obj] = _object[obj];
				}
				for(obj in object){
					if(props.indexOf(obj)>-1) tweenObj.push({property:obj, start:getStyle(_element, obj), end:object[obj]});
					else if(mods.indexOf(obj)>-1) trans = trans || getTransform(_element);
				}
				
				if(trans){//rebuilding the transform string, including all transform properties
					for(i = 0; i < mods.length; i++){
						obj = mods[i];
						tweenObj.push({property:obj, start:trans[obj], end:object.hasOwnProperty(obj)?object[obj]:trans[obj]});
					}
				}
			
				stopTween(_element);
			
				if(tweenObj.length) {
					tweenedIntervals.push(requestAnimationFrame(tween));
					tweenedElements.push(_element);
				}
				function tween(){
					step ++;
					if(!paused && step>=delay){
						step = 0;
						count += 1;
						trans = '';
						for(i = 0; i < tweenObj.length; i++){
							if(tweenObj[i].start == tweenObj[i].end){
								mod = tweenObj[i].end;
							} else {
								if(tweenObj[i].start > tweenObj[i].end){
									obj = tweenObj[i].end + (tweenObj[i].start - tweenObj[i].end) / _duration * (_duration-count);
								} else {
									obj = tweenObj[i].start - (tweenObj[i].start - tweenObj[i].end) / _duration * count;
								}
								mod = ((count >= _duration) ? tweenObj[i].end : obj);
							}

							mod += ((props.indexOf(tweenObj[i].property) > 0 || mods.indexOf(tweenObj[i].property) > 2) ? 'px' : ((!mods.indexOf(tweenObj[i].property))?'deg':'') );
							if(props.indexOf(tweenObj[i].property) > -1){
								_element.style[tweenObj[i].property] = mod;//modify any tweened styles
							} else {
								trans += tweenObj[i].property+'('+mod+') ';//rebuilding the whole transform string
							}
						}
						if(trans.length) _element.style.transform = trans;
						if(count >= _duration){
							stopTween(_element);
							if(_callback) _callback.apply(this, _arguments);
							return;
						}
					}
					i = tweenedElements.indexOf(_element);
					if(i > -1) tweenedIntervals[i] = requestAnimationFrame(tween);
				}
				function getTween(_el){
					if(!_el) return tweenedElements.length;
					return tweenedElements.indexOf(_el);
				}
				function stopTween(_el, _id){
					if(_el) _id = getTween(_el);
					if(_id > -1){
						cancelAnimationFrame(tweenedIntervals.splice(_id, 1));
						tweenedElements.splice(_id, 1);
					}
					return _id;
				}
				function removeAllTweens(){
					for(var _id = tweenedElements.length-1; _id > 0; _id--){
						stopTween(null, _id);
					}
				}
			}
			
			// extracts the floating number from an element's computed style property value
			function getStyle(_element, _property){
				return 1*((window.getComputedStyle(_element, null).getPropertyValue(_property).match(regex)||[0]).map(Number));//function (v){return 1*v;}
			}
			
			// extracts the element's computed style transformation property value, or a whole object of properies (rotate, scale and translate)
			function getTransform(_element, _property){
				var transform = window.getComputedStyle(_element, null).getPropertyValue('transform').replace('matrix(', '').replace('matrix3d(', '').replace(')', '').split(', ').map(Number);
				if(transform.length == 16){
					transform = [transform[0],transform[1],transform[4],transform[5],transform[12],transform[13]];
				} else if(transform.length < 6){
					transform = [1,0,0,1,0,0];
				}
				if(_property) return getTransformObject(transform)[_property];
				return getTransformObject(transform);
			}
			function getTransformObject(a) {
				return {
					translateX: a[4],
					translateY: a[5],
					scaleX: Math.sqrt(Math.pow(a[0], 2) + Math.pow(a[1], 2)),
					scaleY: Math.sqrt(Math.pow(a[2], 2) + Math.pow(a[3], 2)),
					rotate: (180/Math.PI) * Math.atan2(a[3], a[2]) - 90
				};
			}
			
			return{
				o:function(_element, _duration, _object, _callback){
					tweenTo(_element, _duration, _object, _callback, Array.apply(null, arguments).slice(4));
				},
				// p:function(_p){
				// 	if(arguments.length) {
				// 		if(_p || _p === false) paused = _p;
				// 	} else paused = !paused;
				// 	return paused;
				// },
				// s:function(_element){
				// 	if(stopTween(_element) > -1) return;
				// 	removeAllTweens();
				// },
				g:getStyle,
				t:getTransform
			};
		})();

		EX=c=>{
			if(hi) location.hash='s='+hi
			AB()
			ABC()
		}

		zy=c=>{// children selector
			if(c==-1) return z.children
			if(!c) c=0
			return z.children[c].children
		}
		ff=e=>{// fullscreen handler
			var d=document.documentElement
			ex==e.currentTarget||document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen():(d.requestFullscreen||d.mozRequestFullScreen||d.webkitRequestFullScreen||d.msRequestFullscreen).call(d)
		}

		AB=c=>{//base variables initialize (run once)
			//colors data
			sfc=['1c5b0626700c2795002a840a2f9d0747a01c4bb526','25160d503829574c3059664e0c0704','5b4444695b5b938181b0d1a1a0e1b1','25160d503829574c3059664e0c0704','143a2214763a1d290731aa345c4c0085700a','143a223d422d4f57315a70507f9773',,,'000000000000000000000000000000000000000000']
			colors=['153c60161c1e5d695e952008a7a188c9d6c6e82900','362d16364f2d5974508224109da89abc2201c9d6c6','17181c2122535f67647d5e209ba18dc08e27c8d3cb','143a2214763a1d290731aa345c4c0085700a']
			px=[]
			//graphics data
			dta=[
				//tiles
				'@@FG@FCF@ElCC^\\EFf{ZFe^Z\\Zuk_SoirkVns]j|[_beVnqS^bYV_r\\LKktcjtges\\f\\aor{]ZWk\\ZMTcaZ|csSMnbaQQyYazKJJbJJJQQPPLPPPJH@@P@@HP@@@H@@@',//grass
				'@@@@@@QD@@\`C@ZJUB@TMUcXjMYjBjB@PjJU@PMb@U@hD@\`D@B@\`RU@@iDXQ@JUHb@KB@\`jQD@jQc@\`kQP]Lib@\`@jD@\`UD@\`a@@@Hb@L@@@@@@@@@@@@@@@@@@@@@@@@',//the road
				'@@@@@@MC@@XB@KjMA@KmUQmjM]iBiBEPjiU\`HmQ\`M@iEhUBhADHmm@DmBXmmm]hQ@KZmPmMBDimUDPiMHmMiY@H@iB@PMCDXU@@@HY@i@@@@@@@@@@@@@@@@@@@@@@@@',//spike1
				'@@@@@@MC@@XB@KjMA@KmUQmjM]iBiBEPjiU\`HmQ\`M@iEhUBhADHmm@DmBXmmm]hQ@KZmPmMBDimUDPiMHmMiY@H@iB@PMCDXU@@@HY@i@@@@@@@@@@@@@@@@@@@@@@@@',//spike2
				'@B@bBJB@PdPTQTT@PTddbdtQ@qbrQTadPTQTMJbLdbJ^QqTabbrJKNZBPT]A^YqDHJk@sKMb@AFHkshQ@@@Y^F@F@@@]]@@@@@HsC@@@@@hks@@@@@XYMN@@@@iCkkC@',//tree
				'@E@]D@CE@Dhk[AZD@XXbbJ\`@D@SKKYQXQXZYPSKKXbQ@AaQASK@lhH\\PY@]]UC\`Y@ilcZ\\ZLHbeUTccCP]lcjZT\`HTcAcShC@aCJZDSL@HLTAIIA@@A\\H@@@@@HKA@@@',//stone
				'@@@@@@QD@@\`C@ZJUB@TMUcXjMYjBjB@PjJU@PMb@U@hD@\`D@B@\`RU@@iDXQ@JUHb@KB@\`jQD@jQc@\`kQP]Lib@\`@jD@\`UD@\`a@@@Hb@L@@@@@@@@@@@@@@@@@@@@@@@@',//stone
				'@@@@@@MC@@XB@KjMA@KmUQmjM]iBiBEPjiU\`HmQ\`M@iEhUBhADHmm@DmBXmmm]hQ@KZmPmMBDimUDPiMHmMiY@H@iB@PMCDXU@@@HY@i@@@@@@@@@@@@@@@@@@@@@@@@',//stone


				//unit
				//corwin
				'@@T{le@@@XZGYuB@@c\`XFne@@CSlmmE@@X\`kmC@@@@LJJHC@@XpkAGiC@aX^x}HuHCKMgw_nADEYx|HYHhnHCGAHPAuEJHC@JDC@YY@@aB@YPRA@HJJJ@YZ@@YYA@HKC',
				'@@T{le@@@XZGYuB@@c\`XVne@@CSlmmE@@X\`kmC@@@@LJJHC@@YpkAGi@HcX^\`}HFQDKM|l_uHpEY\`gHk@inHCDAYHH]EJHC@QA@H[Y@@d@YAPRA@@JJJ@YZ@@YYA@HKC',
				//'@@T{le@@@XZGYuB@@c\`XVne@@CSlmmE@@X\`kmC@@@@LJJHC@@YpkSAi@HcX^YMHFQDKMcsYuHpEYY\\Hk@inHcSAYHH]EJJC@PA@H[Y@@a@YAPRA@DJJJ@YZ@@YYA@HKC',
				'@@T{le@@@XZGYuB@@c\`XFne@@SSlmmE@@X\`kmC@@@@LJJHC@@ZpkSAiCXaZ^YMHuaZLMcsYnJkCYY\\JYA]]HcSAHHHsEJJC@@QPHXY@@@LXYAB@@\`AJKZYB@@@PYHKC@',
				'@@T{le@@@XZGYuB@@c\`XFne@@SSlmmE@@X\`kmC@@@@LJJHC@@ZpkSAiCXaZ^YMHuaZLMcsYnJkCYY\\JYA]]HcSAHHHsEJJC@@QPHXY@@@LXYAB@@\`AJKZYB@@@PYHKC@',
				
				//bird
				'@@@@@\`|@@@@@@|@@@@@xg\`@@@@@aoE@@@dW|D@@@\`{\`bG@@@XGdO@@@@u@zD@@@@@@M@@@@@@x@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@',
				'@@@@@@@@@h@@@\`|@@x}C@|@@@g_xg\`@@@x|auE@@@gG|D@@@@@|bG@@@@XgO@@@@@\`AD@@@@@}@@@@@@x@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@',
				
				//skeleton
				'@\`KS@@@@@iooB@@@X]]|E@@@HDsXW@@@@ijcZ}@@@@}FiLE@@X\`HE@k@@eMkc@yEhAlYZ@X\\K@@KLE@K@@XYiJ@@@hK@JS@@@XA@XU@@@k@@Hk@@XM@@@YE@Ka@@@LS@',
				'@@lkS@@@@H}}]B@@@kgkkB@@@yC^\`@@@@@\\WUkG@@Hr}Hek@@]AFk@yE@c\`Y]DH\\XAHMSE@Kk@@jai@@Y@PKKKB@@@]A@YU@@XA@@HC@@i@@@kB@XM@@HYE@Ka@@@LS@',
				
				//soldier
				'@@PI[a@@@@Jn]MD@@@PAJkA@@@xfoY@@@@JEKPD@@kCP@LICi^SyaxgY[]DLODzI\\]H\`RaQOXeHBCBA@C@PjeI@@@Xv^mT@XvvUPkB@vEPJJZT@@@JJJRJB@HJB@JJB',
				'@@PI[a@@@@Jn]MD@@@RQHkA@@@D}tY@@@@bSKPD@@@Q@@LYAHkCyQLKk^SOLBYY]L\`RIxI\\]HZPxOAXe@PmLA@@C@skeB@@@sVXUP@@uVJBcJBuFJJJRJB@HJB@JJB',
				
				// chest
				'@@@@@@@@pF@@@@@@Fp@@@@@@@p@@@@@@@F@@jk@@p@@ZURk@@@PRkkREp@jkRZ]J@PKZ]WOU@PeIT}aS@PkxIJnS@P]D\\W]J@P[Y]M]B@@PY]UU@@@@P[MC@@@@@PS@@',
				'@@@@@@@@\`D@@@@@@D\`@@@@@@@\`@@@@@@@D@@jk@@\`@@ZURk@@@PRkkRE\`@jkRZ]J@PMZ]UOS@PSITqU@P]hIJlS@P]DnW]J@P[Y]M]B@@PY]UU@@@@P[MC@@@@@PS@@',

				//-- dog
				'EXYA@@@@CC@j@K@@H@XTXYA\`@@skLEHD@@_]]B@@hSkcK@@@MX\`]aA@XY@@hVTpEH@@@ibU@\`A@\`cKc@\\@@krirC@@HH]uYU@@A@kSkB@XE@a]Y@@lC@|zE@@HH\`\`o@@',
				'h@KC@@YA@K@ZYPCH@@@kLk@\`@@@ueA@@@@Cok\\@@@]Z]aa@@hAHtLT@EK@@JVar@a@@PeJE@HD@bYaS@@@@SNUn@@@Q]Y^]A@XBjkJJB@hC@|eZA@XMx\`WM@@DA@@iA@',
				
				//-- hobbit
				'@@wutG@D@\`kcc{\`g@xmm}\\@DXurUnk]@@Xmmm\\@D@@^tuC@B@@pvFA@D@kKJZ]@@hEYQQkCkH@HJN@M]m@QqA@X\`]@KMj@@P@hE@[m@\`@m@@@kE@hY@@@YA@MK@@@HME',
				'@@twtD@@@xc{}c@D@X|mm]\`gh}kVuj@D@Xlmm]E@@@sekF@D@kBvv@@BhESIBE@DH@HJQkC@m@QqKXM]]@JNA@@k@@KKZ@@\`@h]@hm@P@mC@@kE\`hY@@@YA@MK@@@HME',

				//-- shadow
				'@@PI@@@@@mIAA@X@XMHzTDuC@KOQaBX@@HbJQQhC@@AIIHPAX@I\`OLHIkAHAbRJAHI@IQJI@IIQRIQ@@@HIIRR@@@PIIIIA@@HHJHAI@@@HJ@AHB@@H@AH@Q@@B@@P@P',
				'@@PI@@@F@pIAAEpvXNH}iA@FXkOQMJ@sFKJJQQ@YKHIHRIPAVQaMoIJAIIJlJQI@@IQAQIA@@HIRQI@@@PIQIJ@@@HHIJIA@@@HJQAIB@@IJ@A@Q@@JHBQ@P@@P@@P@@',
				

				//-- ygg
				'@@bb@\`b@@@TdBTd@@@dbBdT@bBcLBbB@TTXRAQcbdJB[Q[Pd\`Tk\\ZeaQ@J\\VcsLB@HXVAsB@@hIJJQA@\`T]@Q]@BbThKbjBAPJ@mTYhB@@@XZkh@@E@]k@@@@h@EC@@@',
				'@@bB@bB@@PTT@Td@@@dbBdT@bBcLDbB@TTXRAQSDbJB[Q[\`bPTlSc]QQ@J^\\rcLB@H^HrCB@\`lJQQIA@bTkJ@k@BPRUTYEBA@HHbmXhB@@@P[kh@@E@]kX@@@h@EC@@@',


			]
			data=dta.join('').replace(/./g,a=>{
				b=a.charCodeAt()
				px.push(b&7)
				px.push((b>>3)&7)
			})

			swords=[//blade//handle//guard// damage: physical world / chaos world / magic world
				[0,'dcc',0,'88d',0,'eee','grayswandir',1,parseInt(1.4+Math.random()*2.5),parseInt(1.6+Math.random()*2.3),2],// the Night Blade
				[3,'696',1,'6a6',2,'7b7','brach of ygg',0,2,4,4],
				[0,'e99',1,'c6f',1,'b6a','flame brand',0,4,3,3],
				[2,'aef',1,'88d',1,'d9f','ice blade',0,5,4,3],
				[2,'caa',0,'a67',0,'d6b','dark knife',0,4,5,0],
				[1,'db9',0,'66a',0,'99e','night blade',0,5,5,5],
				[0,'fbb',1,'68c',2,'dbb','sharp edge',0,6,6,0],
			]
			sword=swords[0]
			for(t=0;t<25;t++){
				swords.push([parseInt(Math.random()*2.9),rc()+rc()+rc(),parseInt(Math.random()*1.9),rc()+rc()+rc(),parseInt(Math.random()*1.9),rc()+rc()+rc(),['dark','night','mithril','crystal','light','golden','iron','amber'][parseInt(Math.random()*7.9)]+' '+['sword','blade','edge','knife','dagger','brand','ripper','scimitar'][parseInt(Math.random()*7.9)],0,1+parseInt(Math.random()*7),1+parseInt(Math.random()*7),parseInt(Math.random()*4)])
			}
			swords.sort(t=(a,b)=>(a[8]+a[9]+a[10]*2)-(b[8]+b[9]+b[10]*2));
			
			console.log(swords)

			e=g=m=n=r=q=l=hi=sc=0//sky count
			S=16//tile size
			W=16//map width
			H=12//map height
			M=[]//map array
			T=[]//tiles graphics
			U=[]//units graphics

			if(window.location.hash) hi=parseInt(window.location.hash.substr(3))
			
			for(t=0;t<parseInt(data.length/256);t++){
				for(j=0;j<S;j++){
					for(i=0;i<S;i++){
						M.push(px[t*256+j*S+i])
					}
				}
			}
			for(j=0;j<8*256;j+=256){
				T.push(M.slice(j,j+256))
			}
			for(j=8*256;j<dta.length*256;j+=256){
				U.push(M.slice(j,j+256))
			}

			this.addEventListener('wheel', E);
			this.addEventListener('resize', R)

			X.t(ui, ']', 5)
			ui.addEventListener('click', uj)
			
			X.t(fs, '[', 5)
			fs.addEventListener('click', ff)
			
			X.t(ex, 'X', 5)
			ex.addEventListener('click', EX)


			cl.addEventListener('click', na)
			

			X.t(id_39, ' !> ', 6)

			X.t(id_37, '! <!!', 6)
			
			X.t(id_38, ' !>!', 6)
			Z.o(id_38,0,{rotate:-90})
			
			X.t(id_40, '! <!', 6)
			Z.o(id_40,0,{rotate:-90})

			X.t(id_32, ' ``!', 6)
			Z.o(id_32,0,{height:39})

			
			for(t = 0; t < 99; t++){//draw storm gradient backgrounds
				j=document.createElement('div')
				j.className='a c s'
				j.style.display = 'none'
				sky.appendChild(j)
				i='linear-gradient(68deg,'
				sc++
				if(sc>76&&sc%2)sc=76;
				for(c=0;c<sc/3;c++){
					i+='rgba('+Math.random()*255+','+Math.random()*255+',0,'+Math.random()/3+'),rgba('+(42+Math.random()*212)+',0,64,'+(0.25+sc/76)+'),'
				}
				i+='rgba(190,12,128,'+(sc>5?.5:sc/10)+') '+sc+'%,rgba(92,12,128,'+(sc>5?.25:sc/20)+'),#09c '+(15+sc*0.85)+'%,#09c '+(85-sc/4)+'%,'
				for(c=0;c<l*2+2+parseInt(sc/10);c++){
					i+=c<1?'#09c,':'#'+parseInt(parseInt(Math.random()*16),16)+'2a,#06b,'
				}
				j.style.backgroundImage=i+'#025)'
			}

			//a:attack, b:, c:color, d:sprite frame, f:number of frames, h:health, i:info name, j:, l:level, m:mana, x:, s:animation type, p:position, r:new position, 
			corwin={t:'p',e:'0f0',a:2,b:0,c:0,d:0,f:4,h:10,j:3,l:1,m:5,x:2,s:3,p:0,r:0,z:0,i:'corwin, prince of amber'}
			bird={t:'o',e:'900',a:0,b:0,c:0,d:4,f:2,s:999,p:0,r:0,z:0,i:'bloodred raven'}
			svord={t:'s',e:'f00',a:0,b:0,c:1,d:0,f:3,s:3,z:0}
			dog={t:'n',e:'913',a:2,b:0,m:0,c:0,d:12,f:2,s:3,p:0,r:0,h:15,z:0,i:'jackal'}
			b1={i:'gg1'}
			b2={i:'gg2'}

			lvl=[
				[
					svord,//sword
					corwin,//player
					bird,//bird
					
					dog,//dog
					cb('q',0,3,18,3,76,0,''),
					{c:0,d:4,f:2,s:2,p:18,i:''}
				],
				[
					svord,
					corwin,
					bird,
					dog,
					cb('e',1,1,6,6,53,6,'skeleton'),
					cb('g',0,1,10,4,94,0,'chest'),
					cb('g',0,2,10,4,37,0,'chest'),
					cb('g',0,2,10,4,148,0,'chest'),
					cb('e',1,1,6,5,132,5,'skeleton'),
					cb('m',5,0,8,3,125,28,'chaos warrior'),
					cb('r',3,0,16,4,151,20,'shadow'),
					cb('q',2,0,14,7,40,10,'leprechaun'),
					cb('g',0,1,10,4,24,0,'chest'),
					
					b1,
					b2
				],
				[
					svord,
					corwin,
					bird,
					dog,
					cb('g',0,2,10,4,148,0,'chest'),
					cb('g',0,1,10,6,42,0,'chest'),
					cb('g',0,2,10,6,75,0,'chest'),
					cb('q',2,0,14,8,35,16,'leprechaun'),
					cb('q',2,0,14,6,97,16,'leprechaun'),
					cb('q',2,0,14,5,99,16,'leprechaun'),
					cb('q',2,1,14,5,106,14,'goblin'),
					cb('g',0,0,10,4,49,0,'chest'),
					//cb('q',0,3,18,3,66,0,'Yggdrasil'),
					cb('m',4,0,8,3,110,32,'chaos warrior'),
					
					b1,
					b2
				],
				[
					svord,
					corwin,
					bird,
					b1,
					b2
				],

				[
					svord,
					corwin,
					bird,
					cb('q',0,3,18,3,50,0,'Ygg'),
					b1,
					b2
				],
				[
					svord,
					corwin,
					bird,
					b1,
					b2
				],
				[
					svord,
					corwin,
					bird,
					b1,
					b2
				]
			]

			ld=[
				'.4354.7545415435.1411.341513135531.d041.c04',//title
				

				'.14.140001314.2545044540414445445104140001354450114115004111511.751.e1.e1.b53101313.71500.2011.15.3255405005.2525222554545555555.455454',//1

				'0.f0.9222.30.3133.5000.3113.50000.111.10.400000.11500411340000041140413334000.8105454555313.300.2111513115.51100455315.553545455313',//1 up

				'.f.f.f.f.f.f.f.f.f.f445',//1 down


				'.f.f.f.445',//2

				'.f.f.f.445',//2 up

				'.f.f.f.445'//2 down
			]
		}
		cb=(t,a,c,d,s,p,h,i)=>{return{t:t,a:a,c:c,d:d,f:2,s:s,p:p,r:p,h:h,z:0,i:i,b:0,m:0}}
		ABC=(c,d,e)=>{// run an area
			if(c&&!+c){// title clicked on tweet button
				if(c.clientX<window.innerWidth/5 && c.clientY<window.innerHeight/5){
					tw("I made a Hi-Score with "+sr+" points in #ChaosVerse! A 13 kilobytes #rpg #adventure by @FoumartGames for #js13k #js13kgames Play: "+window.location.protocol+"//"+window.location.hostname+window.location.pathname+"#s="+hi)
					return;
				}
			}
			l=!c?0:+c?+c:1
			
			c=[[82,66,77,93],[d||81,d?d:-80,d?138:41,d?154:57],[d||166,d||130,40,24],[168,148,84,68],[168,148,84,68],[168,148,84,68],[168,148,84,68]]
			//reposition units when changing levels
			corwin.p=corwin.r=c[l][0]
			bird.p=bird.r=c[l][1]
			dog.p=c[l][2]
			dog.r=c[l][3]
			if(dog.h<1)dog.p=dog.r=-1
			area = W*H;
			// get readable map data, 0:road, 1:grass, 2:snow, 3:road2, 4:road obstacle, 5:grass obstacle, 6:snow obstacle, 7:road2 obstacle,
			M=[]
			for(j=0;j<H;j++){
				for(i=0;i<W;i++){
					if(!l) M.push(j>=5&&j<=7||j>9?3:i-7>j&&j!=1?3:j<6?i<12?0:3:0);
					else if(l==2) M.push(j&&j<7||!i%W||i%W==W-1||j>8?4+parseInt(Math.random()*2):j<7?0:1);
					else M.push(Math.random()*(j>6?10-j:j<4?j:999) > 1 ? j>=4&&j<=6&&((i%2&&j%2)||(i%2==0&&j%2==0))?Math.random()<(j==5?.1:.3)?1:3:Math.random()<(j==3||j==7?.2:0)?3:Math.random()<(j==5?.5:j==4||j==6?.2:0)?3:1 : Math.random()*(12-j)<1&&j>9?!l&&j>10?3:2:0)
				}
			}
			
			for(i=j=0;j<ld[l].length;j++){//read map objects
				c=parseInt(ld[l].charAt(j),16)
				if(ld[l].charAt(j)=='.'){
					j++
					c=parseInt(ld[l].charAt(j),16)
					i+=c
				} else M[i] = c?c:0;
				i++
			}
			//console.log(M);

			f.width = W*S
			f.height = H*(S-4)
			
			h.style.height = H*S+'px'
			
			w = f.getContext('2d');

			K(z);
			for(t = 0; t < lvl[l].length; t++){// create all units
				nm=document.createElement('div')
				nm.className='a b o'//b
				z.appendChild(nm)
				if(t>2)nm.style.zIndex=-t
				if(t){
					c=[]
					for(d = 0; d < lvl[l][t].f; d++){
						np=document.createElement('div')
						np.className='a d'//d
						nm.appendChild(np)
						nn=document.createElement('canvas')
						np.appendChild(nn)
						nn=X.d(nn,'',1.5,'#fff',11,11)
						no=nn.getContext('2d')
						nn.className='a'//d
						//no.clearRect(0,0,16,16)
						if(d>1)nn.style.display='none'
						L(lvl[l][t].d+d,colors[lvl[l][t].c],U,no,0,0)
						c.push(no)
					}
				} else {
					X.d(nm,[')','('][sword[2]],1,'#'+sword[3]).className='a r d'
					X.d(nm,['&','\'','o'][sword[4]],1,'#'+sword[5]).className='a r d'
					X.d(nm,['#','$','%','@'][sword[0]],1,'#'+sword[1],sword[0]==3?8:0).className='a r d'
				}
				
				this[lvl[l][t].t] = lvl[l][t]
				lvl[l][t].z=c
			}
			//t:turns,u:units idle animation frames count,
			t=u=i=j=k=aa=cc=0
			B()
		}
		

		ds=c=>{//update skill buttons
			enemy=c
			df(id_48,['/// 0', 3, ' )', 5, ' &', 5, ' #', 5], corwin.a)
			df(id_49,['/// !1', 3, ' ^', 5], corwin.m)
			df(id_50, ['//  !2', 3.5, '!*', 7], corwin.m>1)
		}//+
		df=(c,d,f,e)=>{
			K(c)
			c.style.display='block'
			for(e=0;e<d.length;e+=2){
				X.t(c, d[e], d[e+1])
			}
			Z.o(c,0,{height:50,width:80,opacity:f?1:.7})
			if(f)c.addEventListener('mouseover', HPB)
			c.style.pointerEvents=f?"auto":"none"
		}

		rc=c=>{//random color
			return(parseInt(9+Math.random()*7)).toString(16)
		}

		uj=(c,e)=>{// toggle ui buttons
			if(ui.style.opacity==1){
				ui.style.opacity=0.5
				c='none'
			} else {
				ui.style.opacity=1
				c='block'
			}
			for(e=0;e<8;e++){
				if(cl.children[e].children.length)cl.children[e].style.display = c;
			}
		}
		uk=c=>{//remove ui buttons,tween?
			id_49.style.display=id_50.style.display=id_48.style.display='none'
			K(id_49)
			K(id_50)
			K(id_48)
		}
		
		E=c=>{//scroll field with mouse wheel
			//if(document.body.offsetHeight>window.innerHeight&&window.innerHeight<1080){
				window.scrollTo(0, window.pageYOffset-c.wheelDelta/6);
			//}
		}

		R=(s,a)=>{// resize event
			s=960/window.innerWidth
			for(a = 0; a < zy(-1).length; a++){
				zy(-1)[a].style.transform='scale('+(3.75/s)+')'
				zy(-1)[a].style.left=(lvl[l][a].p%W*S*(3.75/s))+'px'
				zy(-1)[a].style.top=(parseInt(lvl[l][a].p/W)*(S-5)*(3.75/s)+33.5*(1/s))+'px'
				//Z.o(zy(-1)[a],0,{top:(parseInt(lvl[l][a].p/W)*(S-5)*(3.75/s)+33.5*(1/s)),left:(lvl[l][a].p%W*S*(3.75/s)),s:3.75/s})
			}
			v.style.transform='scale('+(1/s)+')'
			a=Z.g(game,'height')
			cl.style.top=((a>window.innerHeight?window.innerHeight-2:a-6)-Z.g(cl,'height')/s)*s+'px'
		}
		
		L=(D,A,B,C,x,y,a,Y,j,i)=>{//A:colors array, B:pixel data, C:canvas, D:id, x,y:offset, alpha, j,i:local vars
			w.globalAlpha = a || 1
			for(j=Y||0;j<S;j++){
				for(i=0;i<S;i++){
					if(B[D][j*S+i]) N(C, x+i, y+j, A.substr(6*(B[D][j*S+i]-1),6), 1, 1)
				}
			}
			w.globalAlpha = 1
		}
		LA=(c,d,e,b)=>{
			d=d||0
			e=e||0
			lvl[l][c].z[0].clearRect(0,e,W,W-e)
			lvl[l][c].z[1].clearRect(0,e,W,W-e)
			if(!b){
				L(d||lvl[l][1].d,colors[lvl[l][1].c],U,lvl[l][1].z[0],0,0,1,e)
				L(d||lvl[l][1].d+1,colors[lvl[l][1].c],U,lvl[l][1].z[1],0,0,1,e)
			}
		}
		OS=(c,d,e)=>{// draw surface tiles
			if(l)sc=40
			w.clearRect(0,0,f.width,f.height)
			for(d=0;d<H;d++){
				for(c=d*W;c<d*W+W;c++){
					e=d<4||d>6?Math.round(Math.random()*2.5):1
					OO(c,e+2,.2,0,8);OO(c,e+3,0,M[c]>3?4:0)
				}
				for(c=d*W;c<d*W+W;c++){
					e=d<4||d>6?Math.round(Math.random()*2.5):1
					if(M[c]>3){OO(c,e-2,.4,0,8);OO(c,e,.7,0,8);OO(c,e-1,1);OO(c,e-1,1);}
				}
			}
			sc=0
		}
		OO=(b,y,a,c,d)=>{//draw surface////b:id,c:offset(draw shadow),y:position,a:alpha,d:color palette//draw surface and color hilights
			y=y||0
			a=a||0
			c=c||0
			d=d||M[b]-c
			L(M[b]-c, sfc[d],T,w,b%W*S, y+parseInt(b/W)*(S-5)+(b<W?12:8), a?a:[b<5+sc/9?.7-(.5-(11-b)/150)+Math.random()/10+b/30:b>12?0.8-(b-12)/10:.8,.8,M[b]?.7:1,M[b]?.6:.8,b%2?.4:.5,b%2?.6:.5,b%2?.4:.5,M[b]?.6:.8,M[b]?.7:.9,1,1,1][parseInt(b/W)])
		}
		N=(w,x,y,c,v,u)=>{//draw a pixel
			if(!c)return
			w.fillStyle = '#'+c
			w.beginPath()
			w.rect(x,y,v,u)
			w.fill()
		}

		na=c=>{//navigation arrows button click event
			A(+(c.target.id!=''?c.target:c.target.parentNode).id.substr(3))
		}
		
		Y=c=>{//storm advance
			if(c)cc=c
			sky.childNodes[sc].style.display='none'
			if(!l&&sc>64&&Math.random()<.5)sc-=2
			sc++
			if(sc>98)sc=70
			sky.childNodes[sc].style.display='block'
			if(sc<30||!l)Z.o(fs,l?1+parseInt(sc/14):2,{s:1}, Y, cc)//sky animation
			if(sc==cc&&l&&cc){
				j=[7,7,0,5,5,5,0,0,7,0]
				A(39)
			}
		}
		
		I=(d,c)=>{// animation idle units
			u++
			if(d)c=d-1
			else{
				c=0
				d=lvl[l].length
			}
			for(;c<d;c++){
				if(u%lvl[l][c].s){
					if(c){
						zy(c)[u%2?1:0].style.display='block'//switch animation frames idle
						zy(c)[u%2?0:1].style.display='none'
					} else {
						Z.o(zy(-1)[0],0,{x:-1,y:u%2?1:0})//adjust weapon position while idle	
					}
				}
				if(!c)Z.o(zy(0)[2],3,{a:u%2?1:.5+Math.random()/10}, I)//blade fade animation
			}
		}
		D=c=>{// animation bird
			if(c)aa=0
			if(aa)return
			i++
			Z.o(zy(-1)[2],u%2&&c?u%4?2:1:3,{y:i%2?-1:l<3?-1.1:1.3})
			Z.o(zy(-1)[2],u%2&&c?u%4?2:1:3,{y:i%2?0:l<3?-.2:.3}, D)
		}
		bl=(a,b,c,d)=>{//evaluation - player vs enemy
			if(!c){
				c=">"
				d=1
			}
			return a-b*5>0?'   ':a-b>a/2?d?'  '+c:c+'  ':a-b<=0?c+c+c:d?' '+c+c:c+c+' '
		}
		
		A=c=>{//main game loop
			if(c>=0)c={keyCode:c}
			k=k||c.keyCode
			//console.log(k,p.p)
			if(aa&&!c)return
			output=0
			dd=0
			PP=p.p
			pp=PP
			OP=o.p
			if(k==87)k=38
				else if(k==65)k=37
				else if(k==83)k=40
				else if(k==68)k=39
			switch(k){
				case 191:
					output=':'+sr
					if(hi<sr)hi=sr;
					k++;break;
				case 192:EX();return;
				case 38:PP-=W*2
				case 40:PP+=W+1
				case 37:PP--
				default:PP--
				case 39:
					PP++
					if(k==48)AF(enemy)//straight attack
					if(k==49)AF(enemy,1+corwin.l)//skill 1
					if(k==50)AF(enemy,1)//skill 2
					if(M[PP]>3||PP%16==0){
						PP=pp
						//AT(2)
						//output='`s way is blocked'
						FX.t()//stuck sound effect
					} else if(PP>W*H-W) ABC(l+(l==1?2:-1),PP-10*W+1)//down
					 else if(PP<W) ABC(l+(l==1?1:-2),PP+10*W-2)//up
					 else if(l==2&&PP==66){//leprechauns move
						lvl[l][7].r=51
						lvl[l][8].r=81
						lvl[l][9].r=83
						OP=-99
						output=' ambushed. raven dispelled.'
						FX.t()
					} else if(PP%W==W-1){//right advance to next area
						ABC(l+3)
					}

					// interaction
					for(c=3;c<lvl[l].length;c++){
						if(lvl[l][c].h){
							if(PP==lvl[l][c].p)PP=pp
							if(lvl[l][c].m){
								lvl[l][c].m--;
								if(!lvl[l][c].m){//awake enemy after freeze
									lvl[l][c].s=lvl[l][c].b
									zy(c)[1].style.opacity=1
									FX.a(1)
								}
							} else if(PP>=lvl[l][c].p-1&&PP<=lvl[l][c].p+1 || PP-W==lvl[l][c].p || PP+W==lvl[l][c].p){//attack
								PP=pp;
								if(id_49.children.length){
									AF(c)//straight attack
								} else {
									if(k==37){
										AT()
										FX.t()//sound blocked
										//output='`s way is guarded'
									} else {
										ds(c)
										AT()
										FX.a()
										output='!/hp:'+corwin.h+'!/dmg:'+corwin.a+'/ '+bl(lvl[l][c].h,corwin.a,'<')+'|'+bl(corwin.h,lvl[l][c].a)+'/'+lvl[l][c].i+'!/hp:'+lvl[l][c].h+'!/dmg:'+lvl[l][c].a
									}
								}
							}
						} else {
							if(PP-W==lvl[l][c].p || PP+W==lvl[l][c].p || PP+1==lvl[l][c].p || PP-1==lvl[l][c].p){
								//AF()
								if(!lvl[l][c].h){
									j=parseInt(l*4+Math.random()*(l*4+8)-4)
									while(swords[j][7])j=parseInt(l*4+Math.random()*(swords.length-l*4)-4)
									swords[j][7]++
									output=' found '+swords[j][6]
									DE(c)
									FX.a()
									FX.c()
									sr+=swords[j][8]*10+swords[j][9]*15+swords[j][10]*25
								}
							}
						}
					}
					if(!output)uk()

					// bird follow
					if(!output) OP=bf(OP,PP)

					t++

					//some ai decisions below
					if(n.p>0&&n.m<1){//jackal move
						if(PP+W*2 < n.p && M[n.p-W]<4 && M[n.p-W]) n.r=n.p-W;
						else if(PP-W > n.p && M[n.p+W]<4 && M[n.p+W]) n.r=n.p+W;
					}
					if(m.p>0&&m.m<1){//chaos warrior move
						if(PP+W < m.p && M[m.p-W]<4 && M[m.p-W]) m.r=m.p-W;
						else if(PP > m.p && M[m.p+W]<4 && M[m.p+W]) m.r=m.p+W;
					}
					p.r=PP
					o.r=OP
					s.r=PP+1

					//p.h+=dd
					aa=k
					oo=k-37
					k=0
					if(p.h<=0){output=' fell '+t+' steps in' ;k=191}
					if(p.r+1==o.r||!l)k=32//
					
					//show blade from behind trees
					//if(M[PP]!=4)zy()[1].style.visibility=zy()[2].style.visibility='visible'


					
					// hide bottom part of unit behind obstacles
					//if(M[PP+W]>3)LA(1,0,16,1)//???
					if(j.length){
						if(ii<j.length&&l==1){//force initial moves
							k=j[ii]+32
							ii++
							if(ii==j.length){//redraw unit frames - turn jewel on
								corwin.d=0
								LA(1)
								onkeydown=A
								FX.a()
							}
						} else if(ii==j.length)ii++//{
							//ii++;
							//output=' acquired jewel of justice'
						//}
					}
				//break;
			}

			Z.o(hp,6,{a:1},D,1)
			
			for(c=0;c<lvl[l].length; c++){
				dd = lvl[l][c]
				if(dd.r!=dd.p){
					if(!c) RS(0)//reposition sword while moving
					else {
						//move unit animation by 2 or 3 frames
						zy(c)[0].style.transform=zy(c)[1].style.transform='translateX('+15*(dd.r<dd.p&&dd.r>dd.p-W+1?1:dd.r>dd.p&&dd.r<dd.p+W-1?-1:0)+'px) translateY('+11*(dd.r<=dd.p-W?1:dd.r>=dd.p+W?-1:0)+'px)'
						Z.o(zy(c)[0],dd.r<=dd.p-W||dd.r>=dd.p+W?2:3,{x:0,y:0})
						Z.o(zy(c)[1],dd.r<=dd.p-W||dd.r>=dd.p+W?2:3,{x:0,y:0})
						//walk imitation//redraw mid frame
						if(c==1 && M[p.r+W]<4)LA(1,3,12)
					}
					if(dd.r)dd.p=dd.r
				}
			}

			//redraw unit after being hidden by an obstacle
			if(M[p.p+W]>3){LA(1);LA(1,3,12,1)}

			Z.o(sky,2,{s:1},function(){
				//hide sword behind trees
				/*if(M[PP+1]==4){//FX.shuffle()
					zy()[1].style.visibility=zy()[2].style.visibility='hidden'
				}*/

				if(M[p.p+W*2]>3 && oo>0 && oo<3)LA(1)

				RS(1)//reposition sword while moving
				
				Z.o(sky,2,{s:1},function(c){
					//reset sword position
					RS(-1)

					//console clear
					CN()
					
					//redraw unit after being hidden by an obstacle
					if(M[p.p+W]>3)LA(1,3,11,1)
					else LA(1);// otherwise redraw the temporaly walk frame with the standing pose

					//auto play a scheduled move
					if(k>0&&k<191)Z.o(ex,l?0:9,{a:1},A,k)

					//adjust attack depending on the tile the sword is currently in
					c=M[lvl[l][0].p]
					corwin.a=sword[c==1||c==3?9:c==2||c>5?10:8]
				})

			})
			
			I(1)//animation idle main unit

			R()//reposition units

			Y()//sky advance

			if(l)HP()
		}
		bf=(O,P)=>{//bird follow
			if(O<W+2)O+=W
			if(P!=p.p&&P!=O){// bird position while moving
				if(O<P-W-1&&parseInt(O/W)==parseInt((P-W)/W)) O++
				else if(O<P+W-1&&parseInt(O/W)==parseInt((P+W)/W)) O++
				else if(O<P-W-1) O+=W; else if(O>=P+W*2-1) O-=W
				else if((O>P+1&&parseInt(O/W)==parseInt(P/W)) || (O>P-W+1&&parseInt(O/W)==parseInt((P-W)/W)) || (O>P+W+1&&parseInt(O/W)==parseInt((P+W)/W))) O--
				else if(O<P-1&&parseInt(O/W)==parseInt(P/W)) O++
				else if(O==P+1&&P==pp+W)O-=W
				else if(O==P+1&&P==pp-W)O+=W
			} else {// bird position on idle
				if(P+1==p.p)O-=W
				else if(O==P-W-2)O+=1
				else if(O==P+W-2)O+=1
				else if(P!=pp&&O!=P)O=pp
				else if(P!=pp)O=pp
				else if(O==P-W+1)O=P+1
				else if(O==P+1)O=P+W+1
				else if(O==P+W+1)O=P+W
				else if(O==P+W)O=P+W-1
				else if(O==P+W-1)O=P-1
				else if(O==P-1)O=P-W-1
				else if(O==P-W-1)O=P-W
				else if(O==P-W)O=P-W+1;
			}
			return O
		}
		AF=(c,d,e)=>{//attack the enemy
			e=corwin.a
			if(d==1)e=l*2//e*=2
			else if(d>1)e+=d
			AT(1)
			if(k!=37){
				output=' '+(d?d==1?'stun ':'blasted ':'hit ')+lvl[l][c].i+' for '+e+' dmg'
				lvl[l][c].h -= e
				if(lvl[l][c].h<1){
					FX.h(5,1)
					output+=', destroying it'
					if(corwin.m<corwin.l+4)corwin.m+=1
					sr+=lvl[l][c].a*10+lvl[l][c].d//score
					DE(c)
					uk()
					d=0
				} else if(d==1){
					FX.h(3)
					output+=', freezed for '+corwin.j+' turns'
					lvl[l][c].m=corwin.j+1
					lvl[l][c].b=lvl[l][c].s
					lvl[l][c].s=2
					corwin.m-=2
					uk()
					d=0
					Z.o(zy(c)[1],2,{x:2,a:.4},Z.o,zy(c)[1],2,{x:0,a:.9},Z.o,zy(c)[1],2,{x:1,a:.7});
				} else {
					FX.h(2,1)
					if(d){corwin.m--;FX.h(3,1)}
					d=1
					output+='. '+lvl[l][c].i+' hit for '+lvl[l][c].a
					corwin.h-=lvl[l][c].a
					HP()
					//move enemy - fighting
					Z.o(zy(c)[0],3,{x:2},e=>{
						FX.h(1)
						Z.o(zy(c)[0],3,{x:-8},Z.o,zy(c)[0],4,{x:0})
						Z.o(zy(c)[1],3,{x:-8},Z.o,zy(c)[1],4,{x:0})
					})
				}
				if(d)ds(c)
			}
		}
		AT=c=>{//adjust position while attacking
			if(c)zy()[0].style.transform=zy()[1].style.transform=zy()[2].style.transform='translateX(6px) scaleX(-1)'
			zy(1)[0].style.transform=zy(1)[1].style.transform='translateX(6px)'
			Z.o(zy(1)[0],3,{x:6,y:0},c=>{Z.o(zy(1)[0],2,{x:0,y:0});Z.o(zy(1)[1],2,{x:0,y:0})})
		}
		RS=c=>{//reposition sword
			if(c<0)pp=[0,0]
			else if(oo>=0&&oo<=3) pp=[[[9,1],[-2,6],[-12,1],[-2,-6]], [[4,1],[-2,1],[-6,1],[-2,-1]]][c][oo]
			zy(0)[0].style.transform=zy(0)[1].style.transform=zy(0)[2].style.transform='translateX('+pp[0]+'px) translateY('+pp[1]+'px) scaleX(-1)'//adjust sword
		}
		
		DE=(c,d)=>{// destroying a unit
			Z.o(zy(c)[0],9,{a:0})
			Z.o(zy(c)[1],2,{x:1,y:0},Z.o,zy(c)[1],2,{x:-1,y:0},Z.o,zy(c)[1],2,{x:1,y:0},Z.o,zy(c)[1],6,{a:0},d=>lvl[l][c].p=lvl[l][c].r=-1)
		}
		CN=c=>{//console output
			K(cl,8)
			X.t(cl, '  '+(c||(output?'corwin'+output:0)||'@')+'  ', 3, 0, '#fff')
		}
		tw=s=>{//open a new windom for tweet
			wp(window.innerWidth/2, window.innerHeight/2, "http://twitter.com/home?status="+encodeURIComponent(s), "html", "resizable=yes,scrollbars=no,left=0,top=0,screenX=0,screenY=0");
		}
		wp=(...r)=>{
			var a,i,w,h,j
			a = [];
			for(i = 0; i < r.length; i++){
				a.push(r[i]);
			}
			w = a.shift();
			h = a.shift();
			a[2] = ('width=' + w + ',height=' + h + ',' +a[2]);
			try{
				j = window.open.apply(this, a);
				j.addEventListener("load", j.focus, false);
			} catch(err) {console.log(err)}
		}
		
		HP=c=>{// update ui
			K(hp)
			if(l){
//sword
				X.t(hp, '"""//  '+sword[8], 4, 0,!M[s.p]||M[s.p]==4||M[s.p]==5?'#fff':'#999')
				X.t(hp, '"""////'+sword[9], 4, 0,M[s.p]==1||M[s.p]==3?'#fff':'#999')
				X.t(hp, '"""" !'+sword[10], 4, 0,M[s.p]==2||M[s.p]>5?'#fff':'#999')
				X.t(hp, '""""///'+('000').substr(sr>999?3:sr>99?2:sr>9?1:0)+sr, 4.6, 0,'#fff')

				X.t(hp, '//!:'+p.h, 4, 0,'#fff')
				X.t(hp, '"""//:', 4, 0,'#999')

				X.t(hp, ';', 6, 0, '#c22')
				X.t(hp, '!`', 4.5, 0, '#f88')
				if(corwin.d<2){
					X.t(hp, '" *', 6, 0, '#f66')
					X.t(hp, '" _', 6, 0, '#d11')
					X.t(hp, '"":'+corwin.m, 4, 0,'#fff')
				}
				X.t(hp, '"""!'+([')','('][sword[2]]), 4, 0,'#'+sword[3])//handle
				X.t(hp, '"""!'+(['&','"','  o'][sword[4]]), 4, 0,'#'+sword[5])//guard
				X.t(hp, '"""!'+(['#','$','%',' @'][sword[0]]), 4, 0,'#'+sword[1])//blade

				z.addEventListener('mouseover', HPP)
				hp.addEventListener('mouseover', HPO)
			} else {
				X.t(hp, '  hi-score:'+hi, 4, 0,'#fff')
				X.t(hp, '\r\r\r\r\r\r\r\r""""// start game\r\r\r\r\r/13kb of code by noncho savov""////@foumartgames', 3, 0,'#fff')
				X.t(hp, '\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r/inspiration:roger zelazny`s courts of chaos"""""/twitter\r\r\r\r/js13k games 2018"""""""""www.foumartgames.com', 2, 0,'#fff')
				if(hi) X.t(hp, '\r\r  !tweet', 3.5, 0,'#fcc')
				else z.children[z.children.length-1].style.display="none"
			}
		}
		HPO=(c,d,e)=>{
			d=c.target.parentNode
			e=Array.prototype.indexOf.call(d.children,c.target);
			if(d.children.length-e==1)CN(sword[6]+',/damage:'+sword[8]+' '+sword[9]+' '+sword[10])
			else CN()
		}
		HPB=(c)=>{//console.log(c)
			if(+c.target.id.substr(3)) c=+c.target.id.substr(3)-48
			else if(+c.path[1].id.substr(3)) c=+c.path[1].id.substr(3)-48
			CN(['swing:'+corwin.a+' damage','lightning:'+corwin.a+'+'+(corwin.l+1)+' damage, cost:1*','freeze:'+corwin.j+' turns, cost:2*'][c])
		}
		HPP=(c,d,e)=>{
			d=c.target.parentNode.parentNode.parentNode
			e=Array.prototype.indexOf.call(d.children,c.target.parentNode.parentNode)
			if(e)CN(lvl[l][e].i+(lvl[l][e].h&&lvl[l][e].a?'/hp:'+lvl[l][e].h+'/dmg:'+lvl[l][e].a:''))
			else CN()
		}
		
		K=(c,d)=>{//remove all elements
			if(!d)d=0
			while(c.children.length>d){c.removeChild(c.children[d])}
		}

		MS=c=>{// title
			BG()
			Z.o(cl,0,{a:0})
			Z.o(f,0,{a:.5})
			Z.o(h,0,{a:.7})
			if(!l){
				X.t(hp, '\r\r"//   !haos    !erse\r\r\r', 6.75, 0, '#fff')
				X.t(hp, '\r////!C// !V \r\r\r', 10.5, 0, '#fff')
			}
			hp.addEventListener('click', ABC)
		}
		BG=(c,d)=>{
			c=c||0
			d=[
				'#162048 15%, #4a4 22%, #343 34%, #010 41%, #121 62%, #393 80%,#262 85%, #030 88%, #237',
				'#124 13%, #031 14%, #575, #6b6 22%, #2f3f2f 40%, #010 52%, #283828 60%, #6b6 80%, #9f9 86%, #284, #9f9, #395',
				
				'#124 13%, #193 34%, #343',
				'#124 13%, #193 34%, #343',
				'#124 13%, #193 34%, #343'

			][c]
			game.style.backgroundImage='linear-gradient(rgba(8,8,99,0),rgba(16,64,212,0.2) 2%,'+d+')'
		}

		B=c=>{//begin level
			BG(l)
			if(l==1){
				if(o.p==-80){
					hp.removeEventListener('click', ABC)
					Z.o(cl,5,{a:1})
					Z.o(f,5,{a:1})
					Z.o(h,5,{a:1})
					corwin.d=2
					LA(1,2)
					sr=0
					sky.childNodes[sc].style.display='none';
				}
			} else if(!l)ii=0
			HP()//update ui
			sc=0
			OS()//draw surface tiles
			A(0)//main game loop initial run
			CN()//draws text in the bottom console
			R()//resize
			Y(15)//animation sky
			I()//animation idle loop
			if(!l)MS()//title screen texts
		}
		
		AB()//init all game data, runs only once
		ABC()//init level, 0:title screen
		
	</script>
</body>
</html>
